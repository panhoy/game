<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Bot Manager</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px 0;
            border-bottom: 1px solid #eaeaea;
        }
        
        h1 {
            color: #0088cc;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        h2 {
            color: #444;
            margin: 20px 0 15px;
        }
        
        .description {
            font-size: 1.1rem;
            color: #666;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .panel {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 25px;
            margin-bottom: 25px;
        }
        
        .two-columns {
            display: flex;
            gap: 25px;
            flex-wrap: wrap;
        }
        
        .column {
            flex: 1;
            min-width: 300px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #555;
        }
        
        input[type="text"],
        input[type="password"],
        textarea,
        select {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            transition: border 0.3s;
        }
        
        input[type="text"]:focus,
        input[type="password"]:focus,
        textarea:focus,
        select:focus {
            border-color: #0088cc;
            outline: none;
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .btn {
            display: inline-block;
            background-color: #0088cc;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: background-color 0.3s;
        }
        
        .btn:hover {
            background-color: #006699;
        }
        
        .btn-block {
            display: block;
            width: 100%;
        }
        
        .btn-danger {
            background-color: #e74c3c;
        }
        
        .btn-danger:hover {
            background-color: #c0392b;
        }
        
        .btn-success {
            background-color: #2ecc71;
        }
        
        .btn-success:hover {
            background-color: #27ae60;
        }
        
        .btn-warning {
            background-color: #f39c12;
        }
        
        .btn-warning:hover {
            background-color: #e67e22;
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .alert {
            padding: 10px 15px;
            border-radius: 4px;
            margin-bottom: 15px;
        }
        
        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-danger {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .alert-warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
        }
        
        .alert-info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .bot-list {
            list-style: none;
        }
        
        .bot-item {
            padding: 15px;
            border: 1px solid #eaeaea;
            border-radius: 6px;
            margin-bottom: 15px;
            background-color: #fafafa;
            transition: box-shadow 0.3s;
        }
        
        .bot-item:hover {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .bot-item h3 {
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .bot-item p {
            margin: 8px 0;
            color: #666;
        }
        
        .bot-name {
            font-weight: bold;
            color: #0088cc;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .status-active {
            background-color: #d4edda;
            color: #155724;
        }
        
        .status-inactive {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .message-history {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #eaeaea;
            border-radius: 4px;
            padding: 10px;
            margin-top: 15px;
            background-color: #f9f9f9;
        }
        
        .message-item {
            padding: 8px;
            border-bottom: 1px solid #eee;
        }
        
        .message-item:last-child {
            border-bottom: none;
        }
        
        .message-timestamp {
            font-size: 12px;
            color: #888;
            margin-right: 8px;
        }
        
        .message-content {
            margin-top: 3px;
        }
        
        .tab-container {
            margin-bottom: 20px;
        }
        
        .tab-buttons {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 20px;
        }
        
        .tab-button {
            padding: 10px 20px;
            background: none;
            border: none;
            border-bottom: 2px solid transparent;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            color: #666;
            margin-right: 10px;
        }
        
        .tab-button.active {
            border-bottom: 2px solid #0088cc;
            color: #0088cc;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .stats-card {
            text-align: center;
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        .stats-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #0088cc;
            margin: 10px 0;
        }
        
        .stats-label {
            font-size: 1.1rem;
            color: #666;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
            margin-right: 10px;
            vertical-align: middle;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: #0088cc;
        }
        
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        
        .toggle-label {
            display: inline-block;
            vertical-align: middle;
        }
        
        .template-tag {
            display: inline-block;
            padding: 3px 8px;
            background-color: #e1f5fe;
            color: #0277bd;
            border-radius: 4px;
            margin: 3px;
            cursor: pointer;
            font-size: 14px;
            border: 1px solid #b3e5fc;
        }
        
        .template-tag:hover {
            background-color: #b3e5fc;
        }
        
        .template-suggestions {
            margin-top: 10px;
            margin-bottom: 15px;
        }
        
        .search-box {
            position: relative;
            margin-bottom: 20px;
        }
        
        .search-box input {
            padding-left: 40px;
        }
        
        .search-icon {
            position: absolute;
            left: 15px;
            top: 12px;
            color: #888;
        }
        
        @media (max-width: 768px) {
            .two-columns {
                flex-direction: column;
            }
            
            .stats-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Telegram Bot Manager</h1>
            <p class="description">Create, manage, and monitor your Telegram bots in one place</p>
        </header>
        
        <div class="tab-container">
            <div class="tab-buttons">
                <button class="tab-button active" data-tab="dashboard">Dashboard</button>
                <button class="tab-button" data-tab="bots">Manage Bots</button>
                <button class="tab-button" data-tab="messaging">Messaging</button>
                <button class="tab-button" data-tab="settings">Settings</button>
            </div>
            
            <!-- Dashboard Tab -->
            <div class="tab-content active" id="dashboard">
                <div class="panel">
                    <h2>Bot Overview</h2>
                    <div class="stats-grid">
                        <div class="stats-card">
                            <div class="stats-number" id="total-bots">0</div>
                            <div class="stats-label">Total Bots</div>
                        </div>
                        <div class="stats-card">
                            <div class="stats-number" id="active-bots">0</div>
                            <div class="stats-label">Active Bots</div>
                        </div>
                        <div class="stats-card">
                            <div class="stats-number" id="total-messages">0</div>
                            <div class="stats-label">Messages Sent</div>
                        </div>
                        <div class="stats-card">
                            <div class="stats-number" id="total-users">0</div>
                            <div class="stats-label">Total Users</div>
                        </div>
                    </div>
                    
                    <h2>Recent Activity</h2>
                    <div class="message-history" id="recent-activity">
                        <div class="message-item">
                            <span class="message-timestamp">No recent activity</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Bots Tab -->
            <div class="tab-content" id="bots">
                <div class="two-columns">
                    <div class="column">
                        <div class="panel">
                            <h2>Add New Bot</h2>
                            <form id="add-bot-form">
                                <div class="form-group">
                                    <label for="bot-name">Bot Name</label>
                                    <input type="text" id="bot-name" placeholder="Enter a friendly name for your bot">
                                </div>
                                <div class="form-group">
                                    <label for="bot-token">Bot Token</label>
                                    <input type="text" id="bot-token" placeholder="Enter your Telegram bot token">
                                </div>
                                <div class="form-group">
                                    <label for="chat-id">Default Chat ID</label>
                                    <input type="text" id="chat-id" placeholder="Enter the default chat ID">
                                </div>
                                <div class="form-group">
                                    <label for="bot-description">Description (Optional)</label>
                                    <textarea id="bot-description" placeholder="Enter a description for your bot"></textarea>
                                </div>
                                <button type="submit" class="btn btn-block">Add Bot</button>
                            </form>
                        </div>
                    </div>
                    
                    <div class="column">
                        <div class="panel">
                            <h2>Your Bots</h2>
                            <div class="search-box">
                                <span class="search-icon">🔍</span>
                                <input type="text" id="search-bots" placeholder="Search bots...">
                            </div>
                            <ul class="bot-list" id="bot-list">
                                <!-- Bot items will be added here -->
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Messaging Tab -->
            <div class="tab-content" id="messaging">
                <div class="panel">
                    <h2>Send Message</h2>
                    <form id="send-message-form">
                        <div class="form-group">
                            <label for="select-bot">Select Bot</label>
                            <select id="select-bot">
                                <option value="">-- Select a Bot --</option>
                                <!-- Bot options will be added here -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="message-chat-id">Chat ID</label>
                            <input type="text" id="message-chat-id" placeholder="Enter the chat ID or use default">
                        </div>
                        <div class="form-group">
                            <label>Message Template Suggestions</label>
                            <div class="template-suggestions">
                                <span class="template-tag">Greeting</span>
                                <span class="template-tag">Announcement</span>
                                <span class="template-tag">Reminder</span>
                                <span class="template-tag">Poll</span>
                                <span class="template-tag">Event</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="message-content">Message Content</label>
                            <textarea id="message-content" placeholder="Enter your message content"></textarea>
                        </div>
                        <div class="form-group">
                            <label class="toggle-label">
                                <input type="checkbox" id="schedule-message">
                                Schedule for later
                            </label>
                        </div>
                        <div class="form-group" id="schedule-options" style="display: none;">
                            <label for="schedule-date">Schedule Date/Time</label>
                            <input type="datetime-local" id="schedule-date">
                        </div>
                        <button type="submit" class="btn btn-block">Send Message</button>
                    </form>
                </div>
                
                <div class="panel">
                    <h2>Message History</h2>
                    <div class="message-history" id="message-history">
                        <div class="message-item">
                            <span class="message-timestamp">No messages sent yet</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Settings Tab -->
            <div class="tab-content" id="settings">
                <div class="panel">
                    <h2>Application Settings</h2>
                    <div class="form-group">
                        <label class="switch">
                            <input type="checkbox" id="dark-mode">
                            <span class="slider"></span>
                        </label>
                        <span class="toggle-label">Dark Mode</span>
                    </div>
                    <div class="form-group">
                        <label class="switch">
                            <input type="checkbox" id="auto-refresh" checked>
                            <span class="slider"></span>
                        </label>
                        <span class="toggle-label">Auto Refresh (every 30 seconds)</span>
                    </div>
                    <div class="form-group">
                        <label class="switch">
                            <input type="checkbox" id="notifications" checked>
                            <span class="slider"></span>
                        </label>
                        <span class="toggle-label">Show Notifications</span>
                    </div>
                    <div class="btn-group">
                        <button class="btn" id="export-data">Export Data</button>
                        <button class="btn" id="import-data">Import Data</button>
                        <button class="btn btn-danger" id="clear-data">Clear All Data</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
      // Data storage with local storage integration
let bots = [];
let messages = [];
let settings = {
    darkMode: false,
    autoRefresh: true,
    notifications: true
};

// Initialize application
document.addEventListener('DOMContentLoaded', () => {
    loadData();
    initializeEventListeners();
    renderBotList();
    updateSelectBotOptions();
    updateDashboardStats();
    loadSettings();
    startAutoRefresh();
    
    // Show welcome message
    showAlert('Welcome to Telegram Bot Manager!', 'info');
});

// Load data from localStorage
function loadData() {
    const storedData = localStorage.getItem('telegramBotManagerData');
    if (storedData) {
        try {
            const data = JSON.parse(storedData);
            bots = data.bots || [];
            messages = data.messages || [];
            settings = data.settings || {
                darkMode: false,
                autoRefresh: true,
                notifications: true
            };
        } catch (error) {
            console.error('Error loading data:', error);
            showAlert('Error loading saved data. Starting fresh.', 'warning');
        }
    }
}

// Save data to localStorage
function saveData() {
    const data = {
        bots: bots,
        messages: messages,
        settings: settings
    };
    localStorage.setItem('telegramBotManagerData', JSON.stringify(data));
}

// Initialize all event listeners
function initializeEventListeners() {
    // Tab functionality
    document.querySelectorAll('.tab-button').forEach(button => {
        button.addEventListener('click', () => {
            // Remove active class from all buttons and contents
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // Add active class to clicked button and corresponding content
            button.classList.add('active');
            document.getElementById(button.getAttribute('data-tab')).classList.add('active');
        });
    });
    
    // Form submissions
    document.getElementById('add-bot-form').addEventListener('submit', handleAddBot);
    document.getElementById('send-message-form').addEventListener('submit', handleSendMessage);
    
    // Other UI interactions
    document.getElementById('schedule-message').addEventListener('change', toggleScheduleOptions);
    document.querySelectorAll('.template-tag').forEach(tag => {
        tag.addEventListener('click', applyMessageTemplate);
    });
    document.getElementById('search-bots').addEventListener('input', handleBotSearch);
    
    // Data management buttons
    document.getElementById('export-data').addEventListener('click', exportData);
    document.getElementById('import-data').addEventListener('click', importData);
    document.getElementById('clear-data').addEventListener('click', clearData);
    
    // Settings toggles
    document.getElementById('dark-mode').addEventListener('change', updateSettings);
    document.getElementById('auto-refresh').addEventListener('change', updateSettings);
    document.getElementById('notifications').addEventListener('change', updateSettings);
    
    // Bot selection change handler
    document.getElementById('select-bot').addEventListener('change', handleBotSelection);
}

// Handler for adding a new bot
function handleAddBot(e) {
    e.preventDefault();
    
    const botName = document.getElementById('bot-name').value.trim();
    const botToken = document.getElementById('bot-token').value.trim();
    const chatId = document.getElementById('chat-id').value.trim();
    const botDescription = document.getElementById('bot-description').value.trim();
    
    if (!botName || !botToken) {
        showAlert('Please enter both bot name and token', 'danger');
        return;
    }
    
    // Check if token already exists
    if (bots.some(bot => bot.token === botToken)) {
        showAlert('A bot with this token already exists', 'warning');
        return;
    }
    
    const newBot = {
        id: generateId(),
        name: botName,
        token: botToken,
        chatId: chatId,
        description: botDescription,
        isActive: true,
        created: new Date().toISOString(),
        messageCount: 0,
        userCount: Math.floor(Math.random() * 100) + 1, // Simulated user count
        lastActive: new Date().toISOString()
    };
    
    bots.push(newBot);
    
    // Reset form
    document.getElementById('add-bot-form').reset();
    
    renderBotList();
    updateSelectBotOptions();
    updateDashboardStats();
    addActivity(`Bot "${botName}" has been added`);
    
    saveData();
    showAlert(`Bot "${botName}" has been added successfully`, 'success');
}

// Handler for sending a message
function handleSendMessage(e) {
    e.preventDefault();
    
    const selectBot = document.getElementById('select-bot');
    const messageChatId = document.getElementById('message-chat-id');
    const messageContent = document.getElementById('message-content');
    const scheduleMessageCheckbox = document.getElementById('schedule-message');
    
    const botId = selectBot.value;
    const chatId = messageChatId.value.trim();
    const content = messageContent.value.trim();
    const schedule = scheduleMessageCheckbox.checked ? document.getElementById('schedule-date').value : null;
    
    if (!botId) {
        showAlert('Please select a bot', 'danger');
        return;
    }
    
    if (!content) {
        showAlert('Please enter a message', 'danger');
        return;
    }
    
    const bot = bots.find(b => b.id === botId);
    if (!bot) {
        showAlert('Bot not found', 'danger');
        return;
    }
    
    const effectiveChatId = chatId || bot.chatId;
    if (!effectiveChatId) {
        showAlert('Please enter a chat ID', 'danger');
        return;
    }
    
    // Simulate sending message to Telegram
    simulateSendMessage(bot, effectiveChatId, content, schedule);
}

// Simulate the process of sending a message
function simulateSendMessage(bot, chatId, content, schedule) {
    // Show loading indicator
    const sendButton = document.querySelector('#send-message-form button[type="submit"]');
    const originalText = sendButton.textContent;
    sendButton.textContent = 'Sending...';
    sendButton.disabled = true;
    
    setTimeout(() => {
        const success = Math.random() > 0.05; // 95% success rate for simulation
        
        sendButton.textContent = originalText;
        sendButton.disabled = false;
        
        if (success) {
            const message = {
                id: generateId(),
                botId: bot.id,
                botName: bot.name,
                chatId: chatId,
                content: content,
                timestamp: new Date().toISOString(),
                status: schedule ? 'scheduled' : 'sent',
                scheduledFor: schedule
            };
            
            messages.push(message);
            
            // Update bot message count and last active time
            const botIndex = bots.findIndex(b => b.id === bot.id);
            if (botIndex !== -1) {
                bots[botIndex].messageCount++;
                bots[botIndex].lastActive = new Date().toISOString();
            }
            
            renderMessageHistory();
            updateDashboardStats();
            addActivity(`Message ${schedule ? 'scheduled' : 'sent'} to "${bot.name}" (Chat ID: ${chatId.substring(0, 6)}...)`);
            
            // Clear form
            document.getElementById('message-content').value = '';
            if (schedule) {
                document.getElementById('schedule-date').value = '';
                document.getElementById('schedule-message').checked = false;
                document.getElementById('schedule-options').style.display = 'none';
            }
            
            saveData();
            showAlert(`Message ${schedule ? 'scheduled' : 'sent'} successfully`, 'success');
        } else {
            showAlert('Failed to send message. Please try again.', 'danger');
        }
    }, 1000); // Simulate network delay
}

// Toggle schedule options visibility
function toggleScheduleOptions() {
    const scheduleOptions = document.getElementById('schedule-options');
    scheduleOptions.style.display = this.checked ? 'block' : 'none';
    
    // Set default schedule time to tomorrow
    if (this.checked) {
        const tomorrow = new Date();
        tomorrow.setDate(tomorrow.getDate() + 1);
        tomorrow.setHours(10, 0, 0, 0);
        
        const dateInput = document.getElementById('schedule-date');
        dateInput.value = tomorrow.toISOString().slice(0, 16);
    }
}

// Apply message template when a tag is clicked
function applyMessageTemplate() {
    const messageContent = document.getElementById('message-content');
    const templates = {
        'Greeting': '👋 Hello everyone!\n\nThis is a friendly greeting from your bot. How is everyone doing today?',
        'Announcement': '📢 IMPORTANT ANNOUNCEMENT 📢\n\nWe have some exciting news to share with you all. Stay tuned for more details!',
        'Reminder': '⏰ REMINDER ⏰\n\nDon\'t forget about our upcoming event on [DATE]. We\'re looking forward to seeing you there!',
        'Poll': '📊 POLL TIME! 📊\n\nWhat feature would you like to see next in our app?\n\n1. Feature A\n2. Feature B\n3. Feature C\n\nReply with your choice!',
        'Event': '🎉 EVENT INVITATION 🎉\n\nYou\'re invited to join us for [EVENT NAME] on [DATE] at [TIME]. Don\'t miss out!'
    };
    
    messageContent.value = templates[this.textContent] || '';
    messageContent.focus();
}

// Filter bots based on search term
function handleBotSearch() {
    const searchTerm = this.value.toLowerCase();
    renderBotList(searchTerm);
}

// Export data to JSON file
function exportData() {
    const data = {
        bots: bots,
        messages: messages,
        settings: settings,
        exportDate: new Date().toISOString()
    };
    
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `telegram-bot-manager-export-${new Date().toISOString().split('T')[0]}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    showAlert('Data exported successfully', 'success');
}

// Import data from JSON file
function importData() {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = 'application/json';
    
    input.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = (event) => {
            try {
                const data = JSON.parse(event.target.result);
                
                if (!data.bots || !Array.isArray(data.bots)) {
                    throw new Error('Invalid data format: missing bots array');
                }
                
                bots = data.bots;
                if (data.messages && Array.isArray(data.messages)) messages = data.messages;
                if (data.settings) settings = data.settings;
                
                renderBotList();
                renderMessageHistory();
                updateDashboardStats();
                updateSelectBotOptions();
                loadSettings();
                saveData();
                
                addActivity('Data imported successfully');
                showAlert(`Imported ${bots.length} bots and ${messages.length} messages`, 'success');
            } catch (error) {
                console.error('Import error:', error);
                showAlert('Error importing data: ' + error.message, 'danger');
            }
        };
        
        reader.readAsText(file);
    });
    
    input.click();
}

// Clear all application data
function clearData() {
    if (confirm('Are you sure you want to clear all data? This action cannot be undone.')) {
        bots = [];
        messages = [];
        
        renderBotList();
        renderMessageHistory();
        updateDashboardStats();
        updateSelectBotOptions();
        
        localStorage.removeItem('telegramBotManagerData');
        
        showAlert('All data has been cleared', 'success');
    }
}

// Update settings when toggles change
function updateSettings() {
    settings.darkMode = document.getElementById('dark-mode').checked;
    settings.autoRefresh = document.getElementById('auto-refresh').checked;
    settings.notifications = document.getElementById('notifications').checked;
    
    // If auto-refresh was disabled, kill the interval
    if (!settings.autoRefresh && window.autoRefreshInterval) {
        clearInterval(window.autoRefreshInterval);
        window.autoRefreshInterval = null;
    } else if (settings.autoRefresh && !window.autoRefreshInterval) {
        startAutoRefresh();
    }
    
    saveData();
    
    // Apply dark mode if that feature was implemented
    applyDarkMode();
}

// Handle bot selection change
function handleBotSelection() {
    const botId = this.value;
    if (!botId) return;
    
    const bot = bots.find(b => b.id === botId);
    if (bot && bot.chatId) {
        // Set the default chat ID but don't overwrite if already entered
        const chatIdField = document.getElementById('message-chat-id');
        if (!chatIdField.value) {
            chatIdField.value = bot.chatId;
        }
    }
}

// Render the list of bots
function renderBotList(searchTerm = '') {
    const botList = document.getElementById('bot-list');
    botList.innerHTML = '';
    
    const filteredBots = searchTerm ? 
        bots.filter(bot => bot.name.toLowerCase().includes(searchTerm.toLowerCase()) || 
                           (bot.description && bot.description.toLowerCase().includes(searchTerm.toLowerCase()))) : 
        bots;
    
    if (filteredBots.length === 0) {
        botList.innerHTML = '<li class="bot-item">No bots found</li>';
        return;
    }
    
    // Sort bots by active status and then by name
    filteredBots.sort((a, b) => {
        if (a.isActive === b.isActive) {
            return a.name.localeCompare(b.name);
        }
        return a.isActive ? -1 : 1;
    });
    
    filteredBots.forEach(bot => {
        const li = document.createElement('li');
        li.className = 'bot-item';
        
        const statusBadge = `<span class="status-badge ${bot.isActive ? 'status-active' : 'status-inactive'}">${bot.isActive ? 'Active' : 'Inactive'}</span>`;
        
        li.innerHTML = `
            <h3>
                <span class="bot-name">${escapeHtml(bot.name)}</span>
                ${statusBadge}
            </h3>
            <p><strong>Token:</strong> ${maskToken(bot.token)}</p>
            <p><strong>Chat ID:</strong> ${bot.chatId ? escapeHtml(bot.chatId) : 'Not set'}</p>
            <p><strong>Messages:</strong> ${bot.messageCount || 0} sent</p>
            <p><strong>Users:</strong> ~${bot.userCount || 0}</p>
            ${bot.description ? `<p><strong>Description:</strong> ${escapeHtml(bot.description)}</p>` : ''}
            <p><strong>Created:</strong> ${formatDate(bot.created)}</p>
            <p><strong>Last Active:</strong> ${bot.lastActive ? formatDate(bot.lastActive) : 'Never'}</p>
            <div class="btn-group">
                <button class="btn ${bot.isActive ? 'btn-danger' : 'btn-success'}" data-action="toggle-status" data-id="${bot.id}">
                    ${bot.isActive ? 'Deactivate' : 'Activate'}
                </button>
                <button class="btn" data-action="edit-bot" data-id="${bot.id}">Edit</button>
                <button class="btn btn-danger" data-action="delete-bot" data-id="${bot.id}">Delete</button>
            </div>
        `;
        
        botList.appendChild(li);
        
        // Add event listeners to the buttons
        const toggleButton = li.querySelector('[data-action="toggle-status"]');
        const editButton = li.querySelector('[data-action="edit-bot"]');
        const deleteButton = li.querySelector('[data-action="delete-bot"]');
        
        toggleButton.addEventListener('click', () => toggleBotStatus(bot.id));
        editButton.addEventListener('click', () => editBot(bot.id));
        deleteButton.addEventListener('click', () => deleteBot(bot.id));
    });
}

// Toggle bot active status
function toggleBotStatus(botId) {
    const botIndex = bots.findIndex(b => b.id === botId);
    if (botIndex !== -1) {
        bots[botIndex].isActive = !bots[botIndex].isActive;
        saveData();
        renderBotList();
        updateDashboardStats();
        addActivity(`Bot "${bots[botIndex].name}" ${bots[botIndex].isActive ? 'activated' : 'deactivated'}`);
        showAlert(`Bot "${bots[botIndex].name}" ${bots[botIndex].isActive ? 'activated' : 'deactivated'}`, 'success');
    }
}

// Edit a bot's details
function editBot(botId) {
    const bot = bots.find(b => b.id === botId);
    if (!bot) return;
    
    // For simplicity, we'll use prompt dialogs
    // In a real app, this would be a modal form
    const newName = prompt('Enter new name:', bot.name);
    if (newName === null) return;
    
    const newChatId = prompt('Enter new default chat ID:', bot.chatId || '');
    const newDescription = prompt('Enter new description:', bot.description || '');
    
    bot.name = newName.trim() || bot.name;
    bot.chatId = newChatId.trim();
    bot.description = newDescription.trim();
    
    saveData();
    renderBotList();
    updateSelectBotOptions();
    addActivity(`Bot "${bot.name}" updated`);
    showAlert(`Bot "${bot.name}" updated successfully`, 'success');
}

// Delete a bot
function deleteBot(botId) {
    const bot = bots.find(b => b.id === botId);
    if (!bot) return;
    
    if (confirm(`Are you sure you want to delete bot "${bot.name}"? This will also delete all associated messages.`)) {
        // Remove the bot and its messages
        bots = bots.filter(b => b.id !== botId);
        messages = messages.filter(m => m.botId !== botId);
        
        saveData();
        renderBotList();
        renderMessageHistory();
        updateSelectBotOptions();
        updateDashboardStats();
        addActivity(`Bot "${bot.name}" deleted`);
        showAlert(`Bot "${bot.name}" deleted successfully`, 'success');
    }
}

// Update the bot selection dropdown
function updateSelectBotOptions() {
    const selectBot = document.getElementById('select-bot');
    selectBot.innerHTML = '<option value="">-- Select a Bot --</option>';
    
    // Sort bots alphabetically by name
    const sortedBots = [...bots].sort((a, b) => a.name.localeCompare(b.name));
    
    sortedBots.forEach(bot => {
        if (bot.isActive) {
            const option = document.createElement('option');
            option.value = bot.id;
            option.textContent = bot.name;
            selectBot.appendChild(option);
        }
    });
}

// Render message history
function renderMessageHistory() {
    const messageHistory = document.getElementById('message-history');
    messageHistory.innerHTML = '';
    
    if (messages.length === 0) {
        messageHistory.innerHTML = '<div class="message-item"><span class="message-timestamp">No messages sent yet</span></div>';
        return;
    }
    
    // Sort messages by timestamp, newest first
    const sortedMessages = [...messages].sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
    
    sortedMessages.forEach(message => {
        const div = document.createElement('div');
        div.className = 'message-item';
        
        const botName = message.botName || 'Unknown Bot';
        const chatId = message.chatId || 'Unknown Chat';
        
        div.innerHTML = `
            <div>
                <span class="message-timestamp">${formatDate(message.timestamp)}</span>
                <strong>${escapeHtml(botName)}</strong> → Chat: ${maskChatId(chatId)}
                ${message.status === 'scheduled' ? `<span class="status-badge">(Scheduled for ${formatDate(message.scheduledFor)})</span>` : ''}
            </div>
            <div class="message-content">${escapeHtml(message.content)}</div>
        `;
        
        messageHistory.appendChild(div);
    });
}

// Update dashboard statistics
function updateDashboardStats() {
    const totalBotsElement = document.getElementById('total-bots');
    const activeBotsElement = document.getElementById('active-bots');
    const totalMessagesElement = document.getElementById('total-messages');
    const totalUsersElement = document.getElementById('total-users');
    
    const activeBots = bots.filter(bot => bot.isActive);
    const totalMessages = messages.length;
    const totalUsers = bots.reduce((sum, bot) => sum + (bot.userCount || 0), 0);
    
    totalBotsElement.textContent = bots.length;
    activeBotsElement.textContent = activeBots.length;
    totalMessagesElement.textContent = totalMessages;
    totalUsersElement.textContent = totalUsers;
    
    renderRecentActivity();
}

// Add activity to recent activity log
function addActivity(text) {
    // Create a new activity object
    const activity = {
        text: text,
        timestamp: new Date().toISOString()
    };
    
    // Get existing activities or create empty array
    let activities = JSON.parse(localStorage.getItem('recentActivities') || '[]');
    
    // Add new activity at the beginning
    activities.unshift(activity);
    
    // Keep only the 10 most recent activities
    activities = activities.slice(0, 10);
    
    // Save back to localStorage
    localStorage.setItem('recentActivities', JSON.stringify(activities));
    
    // Update the display
    renderRecentActivity();
}

// Render recent activity log
function renderRecentActivity() {
    const recentActivity = document.getElementById('recent-activity');
    recentActivity.innerHTML = '';
    
    const activities = JSON.parse(localStorage.getItem('recentActivities') || '[]');
    
    if (activities.length === 0) {
        recentActivity.innerHTML = '<div class="message-item"><span class="message-timestamp">No recent activity</span></div>';
        return;
    }
    
    activities.forEach(activity => {
        const div = document.createElement('div');
        div.className = 'message-item';
        
        div.innerHTML = `
            <span class="message-timestamp">${formatDate(activity.timestamp)}</span>
            <span>${escapeHtml(activity.text)}</span>
        `;
        
        recentActivity.appendChild(div);
    });
}

// Load settings from stored data
function loadSettings() {
    document.getElementById('dark-mode').checked = settings.darkMode;
    document.getElementById('auto-refresh').checked = settings.autoRefresh;
    document.getElementById('notifications').checked = settings.notifications;
    
    applyDarkMode();
}

// Apply dark mode if enabled (placeholder function)
function applyDarkMode() {
    // This function would implement dark mode styling
    // Not fully implemented in this demo
    if (settings.darkMode) {
        // Would apply dark mode classes to body or container
    } else {
        // Would remove dark mode classes
    }
}

// Start auto-refresh interval
function startAutoRefresh() {
    if (settings.autoRefresh && !window.autoRefreshInterval) {
        window.autoRefreshInterval = setInterval(() => {
            // Check for scheduled messages that should be sent
            checkScheduledMessages();
            
            // In a real app, this would also refresh data from the API
            console.log('Auto-refreshing data...');
        }, 30000); // Every 30 seconds
    }
}

// Check for scheduled messages that need to be sent
function checkScheduledMessages() {
    const now = new Date();
    const scheduledMessages = messages.filter(m => 
        m.status === 'scheduled' && 
        m.scheduledFor && 
        new Date(m.scheduledFor) <= now
    );
    
    if (scheduledMessages.length > 0) {
        scheduledMessages.forEach(message => {
            // Mark as sent
            const msgIndex = messages.findIndex(m => m.id === message.id);
            if (msgIndex !== -1) {
                messages[msgIndex].status = 'sent';
                messages[msgIndex].actualSentTime = now.toISOString();
            }
            
            addActivity(`Scheduled message sent to "${message.botName}"`);
        });
        
        saveData();
        renderMessageHistory();
        if (settings.notifications) {
            showAlert(`${scheduledMessages.length} scheduled message(s) sent`, 'info');
        }
    }
}

// Helper function to show alerts
function showAlert(message, type) {
    const alertDiv = document.createElement('div');
    alertDiv.className = `alert alert-${type}`;
    alertDiv.textContent = message;
    
    // Find a place to insert the alert
    const container = document.querySelector('.container');
    container.insertBefore(alertDiv, container.firstChild);
    
    // Remove the alert after 5 seconds
    setTimeout(() => {
        alertDiv.style.opacity = '0';
        alertDiv.style.transition = 'opacity 0.5s';
        setTimeout(() => alertDiv.remove(), 500);
    }, 5000);
}

// Helper function to mask sensitive information
function maskToken(token) {
    if (!token) return 'Not set';
    return token.substring(0, 6) + '...' + token.substring(token.length - 4);
}

// Helper function to mask chat IDs
function maskChatId(chatId) {
    if (!chatId) return 'Unknown';
    return chatId.substring(0, 4) + '...' + chatId.substring(chatId.length - 4);
}

// Helper function to generate unique IDs
function generateId() {
    return Date.now().toString(36) + Math.random().toString(36).substring(2);
}

// Helper function to format dates
function formatDate(dateString) {
    if (!dateString) return 'N/A';
    const date = new Date(dateString);
    return date.toLocaleString();
}

// Helper function to escape HTML (prevent XSS)
function escapeHtml(text) {
    if (!text) return '';
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

// Helper function to sanitize user input
function sanitizeInput(input) {
    return input.replace(/</g, '&lt;').replace(/>/g, '&gt;');
}

    </script>
</body>